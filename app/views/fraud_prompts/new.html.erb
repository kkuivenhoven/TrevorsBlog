<script>
	document.addEventListener("DOMContentLoaded", () => {
	  const form = document.querySelector("form");
	  const analyzeButton = document.getElementById("analyze-btn");
	  const resultDiv = document.getElementById("categorize_result");
	  console.log("testing...");

	  analyzeButton.addEventListener("click", (event) => {
		event.preventDefault(); // stop the form POST
		console.log("Analyze clicked, running service...");
	    const userInputField = document.getElementById("fraud_prompt_user_input");
	    console.log("userInputField..." + userInputField.value);
		// your fetch() call here

		fetch("/fraud_prompts/categorize", {
		  method: "POST",
		  headers: {
			"Content-Type": "application/json",
			"X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content
		  },
		  body: JSON.stringify({ user_input: userInputField.value })
		})
		  .then(res => res.json())
		  .then(data => {
			resultDiv.textContent = data.result;
		  });

	  });
	});
</script>

<style>
	.card {
	  background-color: #0A192F;
	  border: none;
	  border-radius: 1rem;
	  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
	}

	label {
	  color: #E6E6FA;
	}

	.form-control,
	.form-select {
	  background-color: #1B1F3B;
	  border: 1px solid #a3c293;
	  color: #E6E6FA;
	  border-radius: 0.5rem;
	  padding: 0.75rem;
	}

	.form-control::placeholder,
	.form-select::placeholder {
	  color: #B5838D;
	}

	.btn-primary,
	.btn {
	  background-color: #a3c293;
	  color: #2A2D43;
	  border: none;
	  border-radius: 0.5rem;
	  padding: 0.75rem 2rem;
	  transition: background-color 0.3s ease;
	}

	.btn:hover {
	  background-color: #8caa7f;
	  color: #2A2D43;
	}

	select, .form-select {
	  appearance: none;
	  background-color: #1B1F3B;
	  border: 1px solid #a3c293;
	  border-radius: 0.75rem;
	  padding: 0.75rem 1rem;
	  color: #E6E6FA;
	  font-size: 1rem;
	  font-family: 'Helvetica Neue', sans-serif;
	  background-image: url("data:image/svg+xml;utf8,<svg fill='%23a3c293' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
	  background-repeat: no-repeat;
	  background-position: right 1rem center;
	  background-size: 1rem;
	  box-shadow: inset 0 0 0 1px #1B1F3B, 0 2px 8px rgba(0, 0, 0, 0.2);
	  transition: border-color 0.3s ease, box-shadow 0.3s ease;
	}

	select:focus, .form-select:focus {
	  outline: none;
	  border-color: #8caa7f;
	  box-shadow: 0 0 0 2px #8caa7f;
	}

	option {
	  background-color: #1B1F3B;
	  color: #E6E6FA;
	  padding: 0.5rem;
	  font-family: 'Helvetica Neue', sans-serif;
	}
</style>

<header class="container text-center my-5">
	<h1 class="post-title">Report Fraud</h1>
</header>

<!-- On keystroke for the cosine similarity?
	or do we want to analyze and then let the end user know that 
	their situation sounds more like "blah blah blah fraud"?
	Or should we have a "Categorize for me" button
	-->

<div class="container my-5 text-light">
	<div class="card p-5 rounded shadow" style="background-color: #0A192F; border: none;">

	<%= form_with model: @fraud_prompt, data: { turbo: false }, html: { class: "needs-validation" } do |f| %>
		<div class="mb-3">
		  <%= f.label :prompt_id, "Select a Prompt", style: "color: #E6E6FA; font-weight: bold;" %>
		  <%= f.select :prompt_id, 
				Prompt.all.order(Arel.sql("CASE WHEN title = 'Not Sure Expert' THEN 0 ELSE 1 END")).map { |p| [ "#{p.title} â€“ #{p.description}", p.id ] },
				{ prompt: "Select a prompt" },
				{ class: "form-select", style: "background-color: #1B1F3B; color: #E6E6FA; border: 1px solid #a3c293;" } %>
		</div>

		  <div class="mb-4">
			<%= f.label :user_input, "Describe the situation", class: "form-label" %>
			<%= f.text_area :user_input, class: "form-control rounded", rows: 8, style: "background-color: #1B1F3B; border: 1px solid #a3c293; color: #E6E6FA;" %>
		  </div>

		  <div class="text-center">
			<%= button_tag "Categorize", type: "button", class: "btn btn-lg px-5", id: "categorize_btn", style: "background-color: #a3c293; color: #2A2D43;" %>
			<div id="categorize_result" class="mt-3 text-info"></div>

		  </div>
	<% end %>

	<% unless Rails.env.production? %>
		<button type="button" id="analyze-btn" class="btn btn-lg px-5" style="background-color: #a3c293; color: #2A2D43;">
		  Analyze
		</button>
	<% end %>

    <div id="categorize_result" class="mt-3 text-info"></div>

	</div>
</div>
		
